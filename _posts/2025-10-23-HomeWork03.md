---
layout: post
title: "HomeWork 3"
date: 2025-10-23
markdown: kramdown
---


# üîê RSA Letter Encryption, Decryption & Frequency Attack (Fixed Version)

## üß≠ Introduction

This interactive demo shows **RSA encryption** on letters (`A ‚Üí 0`, `B ‚Üí 1`, ‚Ä¶ `Z ‚Üí 25`), and how it can be **broken** using small primes and **frequency analysis**.

We:
1. Generate RSA keys (`p`, `q`, `e`, `d`, `n`).
2. Encrypt a plaintext message of letters.
3. Decrypt using the private key.
4. Factorize `n` to simulate an attack and verify the decryption.
5. Plot letter frequencies to see if the result looks like English.

> ‚ö†Ô∏è Educational only ‚Äî using very small primes so it‚Äôs easy to break!

---

## üßÆ Step 1: Choose RSA Parameters

Enter small primes and a public exponent, then click **Generate Keys**.

<input id="p" type="number" value="17" style="width:70px;"> √ó 
<input id="q" type="number" value="19" style="width:70px;">  
Public exponent **e**: <input id="e" type="number" value="5" style="width:70px;">  
<button onclick="generateKeys()">Generate Keys</button>

<div id="keyInfo" style="margin-top:10px;font-family:monospace;"></div>

---

## ‚úâÔ∏è Step 2: Encrypt a Message

<input id="plaintext" value="HELLOWORLD" style="width:100%;padding:8px;">  
<button onclick="encrypt()">Encrypt</button>

**Ciphertext (space-separated integers):**
<pre id="cipherOut" style="background:#f5f5f5;padding:6px;"></pre>

---

## üîì Step 3: Decrypt or Attack

<button onclick="decrypt()">Decrypt (using private key)</button>
<button onclick="attack()">Attack (factor n & analyze frequency)</button>

**Recovered text:**
<pre id="recoverOut" style="background:#f5f5f5;padding:6px;"></pre>

---

## üìä Step 4: Frequency Distribution Plot

The bar chart compares **English letter frequencies** with the **decrypted text** to check if it‚Äôs likely correct.

<canvas id="freqPlot" width="700" height="350"></canvas>

---

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ---- Basic math helpers ----
function egcd(a,b){if(b===0)return{g:a,x:1,y:0};const r=egcd(b,a%b);return{g:r.g,x:r.y,y:r.x-Math.floor(a/b)*r.y};}
function modInverse(a,m){const r=egcd(a,m);if(r.g!==1)return null;return (r.x%m+m)%m;}
function modPow(b,e,m){let r=1n,base=BigInt(b)%BigInt(m);e=BigInt(e);m=BigInt(m);
  while(e>0n){if(e&1n)r=(r*base)%m;base=(base*base)%m;e>>=1n;}return Number(r);}
function letterToNum(c){const n=c.toUpperCase().charCodeAt(0)-65;return(n>=0&&n<26)?n:null;}
function numToLetter(n){return String.fromCharCode(65+(n%26));}

// ---- RSA Key variables ----
let N = null;
let D = null;

// ---- Generate Keys ----
function generateKeys(){
  const p = parseInt(document.getElementById('p').value);
  const q = parseInt(document.getElementById('q').value);
  const e = parseInt(document.getElementById('e').value);
  const phi = (p - 1) * (q - 1);
  const d = modInverse(e, phi);
  N = p * q;
  D = d;
  document.getElementById('keyInfo').textContent = `n = ${N}, œÜ(n) = ${phi}, d = ${d}`;
}

// ---- Encrypt ----
function encrypt(){
  const text = document.getElementById('plaintext').value.replace(/[^A-Za-z]/g,'');
  const e = parseInt(document.getElementById('e').value);
  if (!N) return alert("Generate keys first!");
  const cipher = text.split('').map(ch => modPow(letterToNum(ch), e, N));
  document.getElementById('cipherOut').textContent = cipher.join(' ');
}

// ---- Decrypt ----
function decrypt(){
  if (!D || !N) return alert("Generate keys first!");
  const nums = document.getElementById('cipherOut').textContent.trim().split(/\s+/).map(Number);
  const plain = nums.map(c => numToLetter(modPow(c, D, N))).join('');
  document.getElementById('recoverOut').textContent = plain;
  plotFreq(plain);
}

// ---- Frequency Analysis Attack ----
const englishFreq = {a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00153,k:.00772,l:.04025,m:.02406,n:.06749,o:.07507,p:.01929,q:.00095,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.02360,x:.00150,y:.01974,z:.00074};

function factorSmall(n){
  for(let i=2;i*i<=n;i++) if(n%i===0) return [i,n/i];
  return [n];
}

function chiSquared(text){
  const counts={};let total=0;
  for(const ch of text.toLowerCase()){if(ch>='a'&&ch<='z'){counts[ch]=(counts[ch]||0)+1;total++;}}
  let s=0;for(const c in englishFreq){const obs=(counts[c]||0)/total;const exp=englishFreq[c];s+=Math.pow(obs-exp,2)/exp;}
  return s;
}

function attack(){
  const e = parseInt(document.getElementById('e').value);
  const n = N;
  const [p,q] = factorSmall(n);
  const phi = (p-1)*(q-1);
  const d = modInverse(e,phi);
  const nums = document.getElementById('cipherOut').textContent.trim().split(/\s+/).map(Number);
  const plain = nums.map(c => numToLetter(modPow(c, d, n))).join('');
  const score = chiSquared(plain);
  document.getElementById('recoverOut').textContent = `[Attack Result]\np=${p}, q=${q}, d=${d}\nPlaintext: ${plain}\nChi¬≤ score: ${score.toFixed(4)}`;
  plotFreq(plain);
}

// ---- Plot English vs Decrypted Frequencies ----
function plotFreq(text){
  const freq={};let total=0;
  for(const ch of text.toLowerCase()){if(ch>='a'&&ch<='z'){freq[ch]=(freq[ch]||0)+1;total++;}}
  const letters=Object.keys(englishFreq);
  const english=letters.map(l=>englishFreq[l]*100);
  const observed=letters.map(l=>((freq[l]||0)/total)*100);
  const ctx=document.getElementById('freqPlot').getContext('2d');
  if(window.freqChart)window.freqChart.destroy();
  window.freqChart=new Chart(ctx,{
    type:'bar',
    data:{labels:letters,
      datasets:[
        {label:'English %',data:english,backgroundColor:'rgba(54,162,235,0.5)'},
        {label:'Decrypted %',data:observed,backgroundColor:'rgba(255,99,132,0.5)'}
      ]},
    options:{responsive:false,scales:{y:{beginAtZero:true,title:{display:true,text:'Frequency (%)'}}}}
  });
}
</script>
